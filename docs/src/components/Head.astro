---
// Custom Head component that includes PostHog analytics
// Extends the default Starlight Head component
const { head } = Astro.locals.starlightRoute;

const POSTHOG_KEY = import.meta.env.PUBLIC_POSTHOG_KEY;
const POSTHOG_HOST = 'https://ph.scanopy.net';
---

{head.map(({ tag: Tag, attrs, content }) => <Tag {...attrs} set:html={content} />)}

<!-- Force dark mode regardless of system preference -->
<script is:inline>
	document.documentElement.setAttribute('data-theme', 'dark');
	localStorage.setItem('starlight-theme', 'dark');
</script>

<!-- PostHog Analytics - initialized via shared utility -->
<script>
	import { initPostHog, capturePageview } from '$lib/posthog';
	import { hasAnalyticsConsent } from '$lib/cookies';

	// Initialize PostHog (opt-out by default)
	initPostHog({
		apiKey: import.meta.env.PUBLIC_POSTHOG_KEY,
		apiHost: 'https://ph.scanopy.net',
	});

	// If user already consented, capture pageview
	if (hasAnalyticsConsent()) {
		capturePageview();
	}
</script>
